# UltraWork 完整工作流示例

## 场景：实现用户认证 REST API

本示例展示 **UltraWork + OpenSpec + Plan Agent + Sisyphus + Ralph Loop** 的完整协同工作流程。

---

## 📋 目录

1. [OpenSpec 规格定义](spec.json) - 成功标准
2. [UltraWork 激活模板](ultrawork-activation.md)
3. [Plan Agent 提示词](plan-prompt.md)
4. [Sisyphus 委派命令](sisyphus-delegation.md)
5. [Ralph Loop 流程](ralph-loop.md)
6. [完整执行手册](EXECUTION.md)

---

## 🎯 任务概述

**实现一个用户认证 REST API**，包含：
- 用户注册 (`POST /auth/register`)
- 用户登录 (`POST /auth/login`)
- JWT Token 刷新 (`POST /auth/refresh`)
- 用户信息获取 (`GET /auth/me`)

---

## 🚀 快速开始

```bash
# 进入示例目录
cd examples/ultrawork-complete-demo

# 查看完整执行手册
cat EXECUTION.md
```

---

## 📊 工作流概览

```
┌─────────────────────────────────────────────────────────────────┐
│  1. UltraWork 激活                                             │
│     "ULTRAWORK MODE ENABLED! 按以下规格实现..."                │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. OpenSpec 规格验证                                          │
│     • Functional: API 端点功能正常                             │
│     • Observable: 200/400 状态码返回                           │
│     • Pass/Fail: curl 测试通过                                 │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. Plan Agent 规划                                            │
│     • 分析依赖                                                 │
│     • 生成并行任务图                                            │
│     • 输出结构化 TODO + Category + Skills                       │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
          ┌───────────────────────┼───────────────────────┐
          ▼                       ▼                       ▼
    ┌──────────┐           ┌──────────┐           ┌──────────┐
    │  Explore │           │ Librarian│           │  Oracle  │
    │ (代码库)  │           │  (文档)   │           │ (架构)   │
    └──────────┘           └──────────┘           └──────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  4. Sisyphus 执行                                              │
│     • 委派 Category + Skills 优化 Agent                        │
│     • 实时 TODO 跟踪                                           │
│     • 阶段性验证 Build/Test                                    │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  5. Ralph Loop 优化                                           │
│     • 失败: 回滚→分析→修复→重验证                              │
│     • 成功: 重构→回归→证据归档                                 │
└─────────────────────────────────┬───────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│  6. UltraWork 最终验证                                         │
│     • 对照 OpenSpec 逐项检查                                   │
│     • 输出执行命令 + 证据截图                                  │
│     • 确认 ALL TODOs completed                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## ✅ 成功标准

### Functional (功能)
- [ ] 用户注册成功，返回 201 + 用户信息
- [ ] 用户登录成功，返回 200 + JWT Token
- [ ] Token 刷新成功，返回 200 + 新 Token
- [ ] 获取用户信息成功，返回 200 + 用户详情

### Observable (可观察)
- [ ] HTTP 状态码正确 (2xx/4xx)
- [ ] 响应体包含预期字段
- [ ] 错误消息清晰可读

### Pass/Fail (通过测试)
- [ ] `make test` 全部通过
- [ ] `curl` 端点测试全部绿色
- [ ] `lsp_diagnostics` 无错误

---

## 📦 输出产物

- `src/auth/` - 认证服务实现
- `tests/auth/` - 认证测试用例
- `spec.json` - OpenSpec 规格定义
- `evidence/` - 测试证据截图
- `TODO.json` - 任务跟踪记录
